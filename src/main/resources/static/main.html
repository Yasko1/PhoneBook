<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<script>
function delete() {
                $ajax({
                url: "http://localhost:8080/delete/"+id,
                method: 'DELETE',
                });
            }
var baseurl = "http://localhost:8080";
      function loadPersons(){
        var xml = new XMLHttpRequest();
        xml.open("GET",baseurl + "/all",true);
        xml.onreadystatechange = function() {
          if(xml.readyState ===4 && xml.status ===200){
            var persons = JSON.parse(xml.responseText);
            var tbltop = `<table>
			    <tr><th>Id</th><th>Name</th><th>Contacts</th></tr>`;
            //main table content we fill from data from the rest call
            var main ="";
            for (i = 0; i < persons.length; i++){
              main += "<tr><td>"+persons[i].id+"</td><td> </td><td>"+persons[i].name+"</td><td>";
              for(j=0;j<persons[i].contacts.length;j++){
                main+= "<th>" +persons[i].contacts[j].phone +";   </th>";
              }
              main += "</td><td>";
              main += `<form th:action="delete" th:method="delete"><input type="submit"/></form>`;
              main += "</td></tr>";
            }
            var tblbottom = "</table>";
            var tbl = tbltop + main + tblbottom;
            document.getElementById("personinfo").innerHTML = tbl;
            document.getElementById("delete").addEventListener("click", function () {
                $ajax({
                url: "http://localhost:8080/delete/"+id,
                method: 'DELETE',
                })
            },true);
          }
        };
        xml.send();
      }
      window.onload = function(){
        loadPersons();
      }
</script>
<body>
<div><h1>Справочник</h1></div>
<div>
    <h4>Person Form</h4>
    <div>
        <form method="post" id="myform" th:object="${person}" action="/create-person">
            Name: <input type="text" id="name" name="name"></input>
            <button type="submit">Сохранить</button>
        </form>
    </div>
    <h4>Search Form</h4>
    <div>
        <form method="get" id="myformget" th:object="${name}" action="filtersearch">
            Name: <input type="text" id="nameSearch" name="name"></input>
            <button type="submit" >Поиск</button>
        </form>
    </div>
    <h4>Deleting form</h4>
    <div>
            Id: <input type="number" id="id" name="id"></input>
            <button id="delete">Сохранить</button>
    </div>

    <div>
        <form th:action="@{/delete/{id}(id=${persons[i].id})}" th:method="delete"><input type="submit"/></form>
    </div>
    <div id="personinfo"> </div>
</div>
</body>
</html>